-
   name: deploy flask app with CI/CD process
   hosts: remote
   vars:
      src_path: "/var/lib/jenkins/workspace/Deployment"
      des_path: "/project"
    
   tasks:
      
     - name: remove all files from remote directory
       file:
         state: absent
         path: "{{ des_path }}/"
         
     - name: copy files from jenkins system to remote system
       shell: 'cp -r {{ src_path }}/. {{ des_path }}'
         
     - name: stop current running container.
       command: docker container stop deployment_mysql_1 deployment_app_1
       ignore_errors: yes

     - name: remove stopped container
       command: docker rm deployment_mysql_1 deployment_app_1
       ignore_errors: yes

     - name: remove flask_app docker image
       command: docker rmi deployment_app
       ignore_errors: yes

     - name: deploy project using compose file
       command: docker-compose up -d

